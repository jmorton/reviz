function CircularLayout(a){this.graph=a}CircularLayout.prototype.layout=function(){var d=[];var g=((this.graph.nodeCount()));var c=(Math.PI*2)/g;var b=this.graph.display.nodeSize/2.5*g;var f=0;var e;var a;var h;for(key in this.graph.reachable){e=f*c;a=b*Math.cos(e);h=b*Math.sin(e);this.graph.nodes[key].x=a;this.graph.nodes[key].y=h;f++}if(this.graph.display.selection){this.graph.display.selection.x=0;this.graph.display.selection.y=0}return d};function DefaultLayout(a){this.graph=a;this.width=5}DefaultLayout.prototype.layout=function(){var a=this.graph.display.nodeSize*2.5;var c=a*this.width;var d=0;var b=0;for(ix in this.graph.reachable){this.graph.reachable[ix].x=b;this.graph.reachable[ix].y=d;b+=a;if(b>c){d+=a;b=0}}};function DefaultRenderer(a){this.setGraph(a);this.nodeSize=20;this.scale=1;this.offset={x:0,y:0};this.setHovered(null);this.dragged=null;this.dragging=false;this.listen()}DefaultRenderer.prototype={setGraph:function(a){this.graph=a;this.canvas=a.canvas;this.context=a.canvas.getContext("2d")},getGraph:function(){return this.graph},setSelection:function(a){if(this.selection==a){return}if(this.selection!=undefined){this.selection.selected=false}this.selection=a;if(a!=undefined){this.selection.selected=true;this.graph.handleEvent("select",this.selection)}},getSelection:function(){return this.selection},setHovered:function(a){if(this.hovered==a){return}if(this.hovered!=undefined){this.hovered.hovered=false}this.hovered=a;if(a!=undefined){this.hovered.hovered=true;this.graph.handleEvent("select",this.hovered)}},getHovered:function(){return this.hovered}};DefaultRenderer.prototype.blank=function(){this.context.save();this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);this.context.fillStyle=Style.Scene.background;this.context.fillRect(0,0,this.canvas.width,this.canvas.height);this.context.restore()};DefaultRenderer.prototype.draw=function(){this.context.save();this.context.translate(this.offset.x,this.offset.y);this.context.scale(this.scale,this.scale);for(index in this.graph.reachable){var b=this.graph.reachable[index];for(i2 in b.adjacent){var a=b.adjacent[i2];if(b.reachable&&a.reachable){this.drawEdge(b,a)}}}for(index in this.graph.reachable){this.drawNode(this.graph.nodes[index])}if(this.hovered){this.drawNode(this.hovered)}this.context.restore();return this};DefaultRenderer.prototype.drawNode=function(node){with(this.context){save();if(node.style){var custom=node.style||Style.Node}font=Style.Node.font;fillStyle=(custom||Style.Node).fill;strokeStyle=(custom||Style.Node).stroke;lineWidth=Style.Node.lineWidth;font=Style.Node.font;if(this.selection==node){fillStyle=Style.Node.select.fill;strokeStyle=Style.Node.select.stroke;font=Style.Node.font}else{if(this.dragged==node){fillStyle=Style.Node.drag.fill;strokeStyle=Style.Node.drag.stroke}else{if(this.hovered==node){fillStyle=Style.Node.hover.fill;strokeStyle=Style.Node.hover.stroke;font=Style.Node.hover.font}}}translate(node.x,node.y);this.drawPath(node);stroke();fill();this.drawLabel(node);restore()}};DefaultRenderer.prototype.drawPath=function(node){with(this.context){beginPath();arc(0,0,node.getWeight()*this.nodeSize,0,Math.PI*2,false);closePath()}};DefaultRenderer.prototype.drawLabel=function(node){if(this.scale<0.4){return false}if(this.selection==node){this.context.fillStyle=Style.Node.select.fontColor}else{if(this.dragged==node){this.context.fillStyle=Style.Node.drag.fontColor}else{if(this.hovered==node){this.context.fillStyle=Style.Node.hover.fontColor}else{this.context.fillStyle=Style.Node.fontColor}}}with(this.context){textAlign="center";textBaseline="middle";fillText(node.label||node.id,0,0)}};DefaultRenderer.prototype.drawEdge=function(node1,node2){with(this.context){save();beginPath();if(node1.selected||node2.selected){this.context.strokeStyle="rgb(255,255,255)"}else{if(node1.hovered||node2.hovered){this.context.strokeStyle="rgb(192,192,192)"}else{this.context.strokeStyle=Style.Edge.stroke}}lineWidth=Style.Edge.lineWidth;lineTo(node1.x,node1.y);lineTo(node2.x,node2.y);closePath();stroke();restore()}};DefaultRenderer.prototype.redraw=function(){this.blank();this.draw()};DefaultRenderer.prototype.listen=function(){var a=this;this.canvas.addEventListener("mousedown",function(b){a.startDragging(b)},false);this.canvas.addEventListener("mouseup",function(b){if(a.noDragDetected){a.makeSelection(b)}a.stopDragging(b);a.redraw()},false);this.canvas.addEventListener("mousemove",function(b){if(a.dragging){if(a.dragged==null){a.dragScene(b)}else{a.dragNode(b)}}else{a.hovering(b)}if(!a.graph.isPlaying()){a.redraw()}},false);this.canvas.addEventListener("dblclick",function(b){var c=DefaultRenderer.topMost(a.containing(b));if(c!=null){c.toggle();a.graph.cacheReachableNodes()}else{if(a.graph.isPlaying()){a.graph.stop()}else{a.graph.start()}}},false);if(window.addEventListener){this.canvas.addEventListener("DOMMouseScroll",function(b){var c=b.detail*10;a.zoom(c);a.redraw();DefaultRenderer.cancelEvent(b)},false);this.canvas.addEventListener("mousewheel",function(){var b=event.wheelDelta;a.zoom(b);a.redraw();DefaultRenderer.cancelEvent(event)},false)}};DefaultRenderer.cancelEvent=function(a){a=a?a:window.event;if(a.stopPropagation){a.stopPropagation()}if(a.preventDefault){a.preventDefault()}a.cancelBubble=true;a.cancel=true;a.returnValue=false;return false};DefaultRenderer.prototype.makeSelection=function(a){this.setSelection(DefaultRenderer.topMost(this.containing(a)))};DefaultRenderer.prototype.startDragging=function(a){this.lastPoint=a;this.dragging=true;this.dragged=DefaultRenderer.topMost(this.containing(a));this.noDragDetected=true};DefaultRenderer.prototype.stopDragging=function(a){this.dragging=false;this.actuallyDragged=false;this.lastPoint=null;this.dragged=null};DefaultRenderer.prototype.dragScene=function(a){if(this.lastPoint!=undefined){this.offset.x+=(a.clientX-this.lastPoint.clientX);this.offset.y+=(a.clientY-this.lastPoint.clientY)}this.lastPoint=a;this.noDragDetected=false};DefaultRenderer.prototype.dragNode=function(a){this.dragged.x+=(a.clientX-this.lastPoint.clientX)/this.scale;this.dragged.y+=(a.clientY-this.lastPoint.clientY)/this.scale;this.lastPoint=a;this.noDragDetected=false};DefaultRenderer.prototype.hovering=function(a){this.setHovered(DefaultRenderer.topMost(this.containing(a)))};DefaultRenderer.prototype.zoom=function(a){this.scale+=0.001*a;this.scale=Math.max(this.scale,0.1);this.scale=Math.min(this.scale,2.5)};DefaultRenderer.prototype.containing=function(c){var b=this.relativePoint(c);var a=[];for(index in this.graph.reachable){if(this.isPointInNode(b,this.graph.reachable[index])){a[a.length]=this.graph.reachable[index]}}return a};DefaultRenderer.prototype.relativePoint=function(a){return{x:((a.pageX-a.target.offsetLeft)-this.offset.x)/this.scale,y:((a.pageY-a.target.offsetTop)-this.offset.y)/this.scale}};DefaultRenderer.prototype.isPointInNode=function(b,c){var a;a=Graph.distance(b,c)<(this.nodeSize);return a};DefaultRenderer.prototype.lookAt=function(a){var c=this.context.canvas.width/2;var b=this.context.canvas.height/2;this.offset.x=(c-a.x);this.offset.y=(b-a.y);this.redraw()};DefaultRenderer.topMost=function(a){if((a==undefined)||(a.length<0)){return null}else{return a[a.length-1]}};var Style={Scene:{background:"rgb(112,112,112)"},Node:{fill:"rgba(210,210,210,0.8)",stroke:"rgba(55,55,55,0.9)",lineWidth:3,font:'600 14px/2 "Android Sans", "Lucida Grande", sans-serif',fontColor:"rgba(0,0,0,0.9)",drag:{fill:"rgba(225,225,225,0.9)",stroke:"rgba(128,128,128,0.9)",fontColor:"rgb(0,0,0)"},hover:{fill:"rgba(225,225,225,0.9)",stroke:"rgba(255,255,255,0.9)",font:'800 14px/2 "Android Sans", "Lucida Grande", sans-serif',fontColor:"rgb(0,0,0)"},select:{fill:"rgba(255,255,255,1.0)",stroke:"rgba(255,255,255,1.0)",fontColor:"rgba(0,0,0,0.9)"},collapse:{strokeStyle:"rgba(255,255,255,0.5)",lineWidth:1}},Edge:{lineWidth:2,stroke:"rgba(77,77,77,0.7)"}};function ForceDirectedLayout(a){this.graph=a;ForceDirectedLayout.attractiveForce=1;ForceDirectedLayout.equilibrium=100;ForceDirectedLayout.repulsiveForce=100}ForceDirectedLayout.prototype.layout=function(){this.graph.eachPair(ForceDirectedLayout.repel);this.graph.eachEdge(ForceDirectedLayout.attract);return true};ForceDirectedLayout.repel=function(a,b){if((this.dragged==a)||(this.selection==a)){return false}a.add(repulsiveForce(a,b,ForceDirectedLayout.repulsiveForce))};ForceDirectedLayout.attract=function(a,b){if((this.dragged==b)||(this.selection==b)){return false}b.add(springForce(a,b,ForceDirectedLayout.attractiveForce,ForceDirectedLayout.equilibrium))};ForceDirectedLayout.distance=function(b,a){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))};ForceDirectedLayout.angle=function(b,a){return Math.atan((b.y-a.y)/(b.x-a.x))};function springForce(g,e,f,c){var b=ForceDirectedLayout.distance(g,e);var a=ForceDirectedLayout.angle(g,e);if(b<c){return{x:0,y:0}}var d=-(c-b)*f;var j=d*Math.cos(a);var h=d*Math.sin(a);if(g.x<e.x){j=-j;h=-h}return{x:j,y:h}}function repulsiveForce(g,f,e){var d=(e/ForceDirectedLayout.distance(g,f))*0.6;var c=ForceDirectedLayout.angle(g,f);if(d<0.1){return{x:0,y:0}}var b=d*Math.cos(c);var a=d*Math.sin(c);if(g.x<f.x){b=-b;a=-a}return{x:b,y:a}}function Graph(a){this.nodes={};this.edges=[];this.setCanvas(a);this.setLayout(new DefaultLayout(this));this.setDisplay(new DefaultRenderer(this));this.setDepth(2);this.callbacks={}}Graph.prototype={setCanvas:function(a){this.canvas=document.getElementById(a)},getCanvas:function(){return this.canvas},setLayout:function(a){this.layoutWith=a;this.layoutWith.graph=this},getLayout:function(){return this.layoutWith},setDisplay:function(a){this.display=a;this.display.graph=this},getDisplay:function(){return this.display},setDepth:function(a){this._depth=a;this.cacheReachableNodes()},getDepth:function(){return this._depth}};Graph.prototype.add=function(){var a;for(i=0;i<arguments.length;i++){a=new Node(arguments[i]);if(this.nodes[a.id]==undefined){this.nodes[a.id]=a}}if(this.rootNode==undefined){this.rootNode=a}this.cacheReachableNodes();return this};Graph.prototype.connect=function(b){var a=this.nodes[b];var c;for(i=arguments.length-1;i>=0;i--){c=this.nodes[arguments[i]];if(c==undefined){c=new Node(arguments[i]);this.nodes[c.id]=c}a.connect(c);c.connect(a);this.edges.push([a,c]);this.edges.push([c,a])}this.cacheReachableNodes();return this};Graph.prototype.nodeCount=function(){var a=0;for(key in this.nodes){if(this.reachable.hasOwnProperty(key)){a++}}return a};Graph.prototype.applyDisplay=function(){return this.display.redraw()};Graph.prototype.applyLayout=function(){return this.layoutWith.layout()};Graph.prototype.animate=function(a){a.applyLayout();a.applyDisplay()};Graph.prototype.start=function(){this.playInterval=window.setInterval(this.animate,25,this);return true};Graph.prototype.stop=function(){window.clearInterval(this.playInterval);this.playInterval=null;return true};Graph.prototype.isPlaying=function(){return(this.playInterval!=undefined)&&(this.playInterval!=null)};Graph.prototype.activeNodes=function(){var a=[];return a};Graph.prototype.visibleNodes=function(){};Graph.prototype.eachPair=function(c){var b,a;for(i1 in this.reachable){b=this.reachable[i1];for(i2 in this.reachable){a=this.reachable[i2];if(b!=a){c.call(this.display,b,a)}}}return true};Graph.prototype.eachEdge=function(a){var b;for(index in this.edges){b=this.edges[index];a.call(this.display,b[0],b[1])}return true};Graph.prototype.cacheReachableNodes=function(){if((this.nodes==undefined)||(this.rootNode==undefined)){this.reachable=[];return[]}for(ix in this.nodes){this.nodes[ix].reachable=false}if(this.getDepth()>=0){this.reachable=this.rootNode.traverse({},this.getDepth())}else{this.reachable=this.nodes}for(ix in this.reachable){this.nodes[ix].reachable=true}return this.reachable};Graph.prototype.handleEvent=function(a,b){if(this.callbacks[a]){this.callbacks[a].call(this,b)}};Graph.prototype.onNodeSelect=function(a){this.callbacks.select=a};Graph.distance=function(b,a){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))};function Node(b,a){this.id=b;this.label=a;this.x=0;this.y=0;this.adjacent=[]}Node.prototype.add=function(a){this.x+=a.x;this.y+=a.y};Node.prototype.connect=function(a){this.adjacent.push(a)};Node.prototype.mass=function(a){this.node.children.length};Node.prototype.getWeight=function(a){return 1};Node.prototype.traverse=function(b,a,c){if(b[this.id]==undefined){b[this.id]=this;if(c==undefined){this.depth=1}else{this.depth=c}if(a>0&&true&&this.expanded()){for(ix in this.adjacent){b=this.adjacent[ix].traverse(b,a-1,c+1)}}}return b};Node.prototype.collapse=function(){this._collapsed=true};Node.prototype.collapsed=function(){return this._collapsed==true};Node.prototype.expand=function(){this._collapsed=false};Node.prototype.expanded=function(){return this._collapsed!=true};Node.prototype.toggle=function(){this._collapsed=!this._collapsed};Node.prototype.isHidingChildren=function(){return(this.collapsed()&&(this.adjacent.length>0))};