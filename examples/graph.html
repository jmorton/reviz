<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Graph on a Canvas</title>
<style><!--
* {
	font-family: 'Droid Sans', 'Lucida Grande', 'Verdana';
	font-size: 10pt;
}
h1 {
	font-size: 2em;
}
h2 {
	font-size: 1.4em;
}
#myGraph {
	border: 1px solid #ccc;
}
.done {
}
#controls {
  padding: 1em 0;
}
.slider {
  width: 10em;
}
#controls .ui-slider .ui-slider-handle {
	width: 0.5em; margin-left: -0.25em;
}
#controls .ui-slider {
	height: 10px;
}
#controls input[type="text"] {
  width: 5em;
  font-size: 1.8em;
  border: none;
}
#controls .text {
}
#controls input[type="button"] {
  display: inline;
}
ul, li {
  list-style: none;
  margin: 0 1.5em 0 0;
  padding: 0;
}

ul.compact li {
  float:left;
  margin-right: 1em;
  width: 15em;
}

fieldset {
  margin: 0.5em 0 1em 0;
  padding: 0;
  border: none;
  clear: both;
}

--></style>
<!--[if IE]><script type="text/javascript" src="../js/excanvas.compiled.js"></script><![endif]-->

<link type="text/css" href="../css/ui-lightness/jquery-ui-1.8.4.custom.css" rel="stylesheet" />	
<script type="text/javascript" src="../js/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="../js/jquery-ui-1.8.4.custom.min.js"></script>

<script type="text/javascript" src="../src/default-layout.js"></script>
<script type="text/javascript" src="../src/default-renderer.js"></script>
<script type="text/javascript" src="../src/force-layout.js"></script>
<script type="text/javascript" src="../src/circular-layout.js"></script>
<script type="text/javascript" src="../src/graph.js"></script>
<script type="text/javascript" src="../src/node.js"></script>
<script type="text/javascript" src="../src/default-layout.js"></script>

<script>
Style.Scene.background = "040507";
</script>

</head>

<body>

<h1>Canvas Based Graph Visualization</h1>

<canvas id="myGraph" width="900" height="450"></canvas>

<div id="controls">

<form>
	<fieldset>
      <label for="layout">Layout</label>
      <select id="layout" name="layout" onchange="updateLayout()">
      <option value="default">Tile Based</option>
      <option value="force-layout">Force Directed</option>
      <option value="circular-layout">Circular</option>
      </select>
      <input type="button" value="Start/Stop" onclick="toggle()" />
      <input type="button" value="Save Image" onclick="saveCanvas()" />
      <ul class="compact">
	      <li>      
		      <label for="zoom">Zoom</label>
		      <input id="zoom" type="text">
		      <div id="zoomSlider" class="slider"></div>
	      </li>	      	
		  <li>      
		      <label for="size">Size</label>
		      <input id="size" type="text">
		      <div id="sizeSlider" class="slider"></div>
	      </li>
		  <li>      
		      <label for="depth">Depth</label>
		      <input id="depth" type="text">
		      <div id="depthSlider" class="slider"></div>
	      </li>
      </ul>
      	
    </fieldset>
    <fieldset id="forceLayoutParameters">
      <ul class="compact">

		<li>
	      <label for="repulsiveForce">Repulsion</label>
	      <input id="repulsiveForce" name="repulsiveForce" type="text">
	      <div id="repulsiveForceSlider" class="slider"></div>
		</li>
		
		<li>
	      <label for="attractiveForce">Attraction</label>
	      <input id="attractiveForce" type="text">
	      <div id="attractiveForceSlider" class="slider"></div>
		</li>
		
		<li>
	      <label for="attractiveEquilibrium">Equilibrium</label>
	      <input id="attractiveEquilibrium" type="text">
	      <div id="attractiveEquilibriumSlider" class="slider"></div>
		</li>
		      
      </ul>
    </fieldset>
  
</form>
</div>

<h2>Basic Controls</h2>
<ul class="tips">
<li class="done">Double click the graph drawing area to start/stop automatic layout.</li> 
<li class="done">Use your mousewheel to zoom in and out</li>
<li class="done">Click and drag a node to move it, this will also make it temporarily immune to layout forces.</li>
<li class="done">Click and drag the background to pan</li>
<li class="done">Double click a node to show/hide it's children.</li> 
</ul>

<script  type="text/javascript"><!--

var g = new Graph('myGraph');
g.add('foo');
g.connect('foo', 'bar', 'baz', 'grault','zork');
g.connect('grault', 'qux','quux');
g.connect('zork','smee','prosser','gru','phee','bor');
g.connect('foo','a');
g.connect('a','b');
g.connect('b','c');
g.connect('c','d');
g.connect('d','e');
g.connect('e','f');
g.connect('f','g');
g.connect('g','h');
g.connect('h','i');
g.connect('i','j');
g.connect('j','k');
g.connect('k','l');
g.connect('l','m');
g.connect('f','n');
g.connect('g','n');
g.connect('h','n');
g.connect('i','n');
g.connect('j','n');

Style.Scene.background = 'rgb(128,128,128)';

Style.Red = {
	fill:   'rgba(225,0,0,0.9)',
	stroke: 'rgba(225,0,0,0.75)'
};

Style.DarkRed = {
	fill:   'rgba(155,0,0,0.9)',
	stroke: 'rgba(155,0,0,0.75)'
};

Style.Gold = {
  fill: '8C5F32',
  stroke: '4C331B'
}

g.nodes.foo.style = Style.Gold;
g.nodes.phee.style = Style.Gold;

g.onNodeSelect(function (node) {
//	console.log(node.id);
});

g.onNodeHovered = function (node) {
//	console.log(node);
}

// Once the initial layout is done... switch to something fancy.
g.layout = new DefaultLayout(g);
g.applyLayout();
g.display.lookAt(g.nodes.foo);

function toggle() {
	if (g.isPlaying()) {
		g.stop();		
	} else {
		g.start();
	}
}

function updateLayout() {
  g.stop();
  var selectedLayout = document.getElementById('layout').value;
  switch (selectedLayout) {
    case 'force-layout' :
      g.setLayout(new ForceDirectedLayout(g));
      break;
    case 'circular-layout' :
      g.setLayout(new CircularLayout(g));
      break;
    default :
      g.setLayout(new DefaultLayout(g));
      break;
  }
  if (!g.display.selection) {
    g.display.selection = g.nodes.foo;
  }
  g.display.lookAt(g.nodes.foo);
  g.start();
}

$(function() {
	$("#repulsiveForceSlider").slider({
		value: 100,
		min:   1,
		max:   500,
		step:  1,
		slide: function(event, ui) {
			$("#repulsiveForce").val(ui.value);
			ForceDirectedLayout.repulsiveForce  = ui.value;
			g.animate(g);
		}
	});
	$("#repulsiveForce").val($("#repulsiveForceSlider").slider("value"));
	
	$("#attractiveForceSlider").slider({
		value: 0.5,
		min:   0.1,
		max:   1.0,
		step:  0.1,
		slide: function(event, ui) {
			$("#attractiveForce").val(ui.value);
			ForceDirectedLayout.attractiveForce  = ui.value;
			g.animate(g);
		}
	});
	$("#attractiveForce").val($("#attractiveForceSlider").slider("value"));

	$("#attractiveEquilibriumSlider").slider({
		value: 20,
		min:   20,
		max:   500,
		step:  1,
		slide: function(event, ui) {
			$("#attractiveEquilibrium").val(ui.value);
			ForceDirectedLayout.equilibrium = ui.value;
			g.animate(g);
		}
	});
	$("#attractiveEquilibrium").val($("#attractiveEquilibriumSlider").slider("value"));

	$("#zoomSlider").slider({
		value: 1.0,
		min:   0.1,
		max:   2.0,
		step:  0.1,
		slide: function(event, ui) {
			$("#zoom").val(ui.value);
			g.display.scale = ui.value;
			g.animate(g);
		}
	});
	$("#zoom").val($("#zoomSlider").slider("value"));
	
	$("#sizeSlider").slider({
		value: 25,
		min:   10,
		max:   100,
		step:  1,
		slide: function(event, ui) {
			$("#size").val(ui.value);
			g.display.nodeSize = ui.value;
			g.animate(g);
		}
	});
	$("#size").val($("#sizeSlider").slider("value"));
	
	$("#depthSlider").slider({
		value: -1,
		min:   -1,
		max:   42,
		step:  1,
		slide: function(event, ui) {
			$("#depth").val(ui.value);
			g.setDepth(ui.value);
			g.animate(g);
		}
	});
	$("#depth").val($("#depthSlider").slider("value"));

});

function saveCanvas() {
	g.save();
}

--></script>
</body>
</html>